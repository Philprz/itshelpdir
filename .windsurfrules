 - name: "Handle User Query"
    description: "Process user queries and generate responses based on the analysis and detected intentions."
    conditions:
      - type: "message_received"
        platform: "web"
    actions:
      - type: "initialize_session"
        description: "Initialize the session for the user query."

      - type: "analyze_question"
        description: "Analyze the user's question to understand the context and extract relevant information."
        parameters:
          - name: "question"
            value: "{{message.content}}"

      - type: "detect_intent"
        description: "Detect the user's intent based on the analyzed question."
        parameters:
          - name: "question"
            value: "{{analyze_question.output.question}}"

      - type: "contextual_search"
        description: "Perform a contextual search across the relevant data sources based on the detected intent."
        parameters:
          - name: "intent"
            value: "{{detect_intent.output.intent}}"
          - name: "sources"
            value:
              - "NETSUITE"
              - "SAP"
              - "NETSUITE_DUMMIES"
              - "JIRA"
              - "ZENDESK"
              - "CONFLUENCE"

      - type: "call_external_service"
        description: "Call external services (e.g., OpenAI) to generate a response based on the search results."
        parameters:
          - name: "service"
            value: "OpenAI"
          - name: "prompt"
            value: "{{contextual_search.output.results}}"

      - type: "generate_response"
        description: "Generate the final response for the user based on the external service output."
        parameters:
          - name: "response"
            value: "{{call_external_service.output.response}}"

      - type: "store_in_database"
        description: "Store the user query and the generated response in the database for future reference."
        parameters:
          - name: "database"
            value: "SQLite"
          - name: "query"
            value: "{{message.content}}"
          - name: "response"
            value: "{{generate_response.output.response}}"

      - type: "send_response"
        description: "Send the generated response back to the user via the web interface."
        parameters:
          - name: "response"
            value: "{{generate_response.output.response}}"